---
layout: python

formprocessor: "https://forms.office.com/Pages/ResponsePage.aspx?id=AxwfkomGYE6nIvXqWB4A_nIJo29clMpGiv8nq8FL3odUM0RONlk4MVpWM0oxQ1hDQTlVUUZGSFJLSi4u&rea93eef7d49340229a7bce32c271def1=magic&rc7ee73f3a5fb40ef97df30fd91b76e5e=title&raefb4937d6934da39139c1271ebc9f11=studentnetid&ra87702e877e5419193a4f88bd9f2aa3d=code&r087f3b9fb5b543568bd5e42d538491cb=canvasasmtid&raba5147d248646e2b321b0fcaf2fb7b3=canvaspoints&r86fe5e43a24444978a7939c077b7c12a=canvashalfcredit"
enctype: "application/x-www-form-urlencoded"
facultyemail: "ctralie@ursinus.edu"

formprocessordirections: "Clicking Run below will check your work and, if it passes, will submit your work automatically. <strong>This should be reflected on canvas in a couple of minutes</strong>"

submitformlinkdirections: "Clicking Run below will check your work and, if it passes, make a page appear above that you can use to submit your work or with further instructions."

mynetid: ctralie
---

<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
<script src="{{site.baseurl}}/assets/js/jquery.min.js"></script>
<script src="{{site.baseurl}}/assets/js/skel.min.js"></script>
<script src="{{site.baseurl}}/assets/js/util.js"></script>
<script src="{{site.baseurl}}/assets/js/main.js"></script>

<style>
.image_off, #home:hover .image_on{
   display:none
}
.image_on, #home:hover .image_off{
   display:block
}
{% for file in page.files %}
{% if file.ismain == false %}
#{{ file.name }}Editor {
    {% if file.isvisible == true %}
    position: relative;
    width: 700px;
    {% if file.height %}
    height: {{file.height}}px;
    {% else %}
    height: 250px;
    {% endif %}
    {% else %}
    position: fixed;
    bottom: 10px;
    visibility: hidden
    {% endif %}
}
{% else %}
#mainEditor {
    {% if file.isvisible == true %}
    position: relative;
    width: 700px;
    height: 100px;
    {% else %}
    position: fixed;
    bottom: 10px;
    visibility: hidden
    {% endif %}
}
{% endif %}
{% endfor %}

#feedbackText {
    position: relative;
    width: 700px;
    height: 100px;
}

</style>

<script src="{{site.baseurl}}/assets/js/ace.js" type="text/javascript" charset="utf-8"></script>
<script src="{{site.baseurl}}/assets/js/modules-common.js" type="text/javascript" charset="utf-8"></script>

<div id="main" role="main">
  <div class="archive">    
    <h1 class="page__title">{{ page.title }}{% if page.info.points %} ({{page.info.points}} Points){% endif %}</h1>
        Developed by <a href="https://www.ursinus.edu/live/profiles/4502-christopher-tralie">Professor Tralie</a> and <a href="https://www.ursinus.edu/live/profiles/5313-william-mongan">Professor Mongan</a>.

        {% if page.info.prev or page.info.next %}
        <p>
        {% if page.info.prev %}
        <button onclick="window.location.href = '{{ page.info.prev }} ';"> &lt--- Previous</button>
        {% endif %}
        {% if page.info.next %}
        <button onclick="window.location.href = '{{ page.info.next }}';">Next ---&gt</button>
        {% endif %}
        </p>
        <HR>
        {% endif %}
        
        {% if page.info.goals %}
        <h1>Exercise Goals</h1>
        The goals of this exercise are:
        <ol>
        {% for goal in page.info.goals %}
        <li>{{goal}}</li>
        {% endfor %}
        </ol>
        {% endif %}
        
        {% if page.info.instructions %}
        {{ page.info.instructions }}
        {% endif %}
        
        <div id="correctArea"></div>
        
        <p>
        <strong>Enter your Ursinus netid before clicking run.  This is <u>not</u> your ID number or your email.  For example, my netid is <code>{{layout.mynetid}}</code> (non Ursinus students can simply enter their name to get this to run, but they won't get an e-mail record or any form of credit)</strong> 
        </p>
        <table>
            <tr>
                <td>
                    Netid
                </td>
                <td>
                    <input type="text" id="studentnetid" name="studentnetid" onchange="if(document.getElementById('studentnetid').value.length > 0) document.getElementById('runbutton').disabled = false; else document.getElementById('runbutton').disabled = true;">
                </td>
            </tr>
        </table>
        
        {% if layout.formprocessor and layout.formprocessor != false %}
        {{ layout.formprocessordirections }}<br>
        {% endif %}
        {% if page.processor.submitformlink and page.processor.submitformlink != false %}
        {{ layout.submitformlinkdirections }}<br>
        {% endif %}

        <button type = "button" onclick = "if(document.getElementById('studentnetid').value.length > 0) runCode(); else correctArea.innerHTML = '<h3><font color = #AA0000>Please enter your netid first!</font></h3>';" id="runbutton" disabled>â–¶ Run</button>
        </p>
        
        <!-- Must name main file "main" and the div tag here/css/processing code below is hardcoded to mainEditor -->
        {% for file in page.files %}
        {% if file.isvisible == true %}
        <h3>{{ file.filename }}</h3>
        {% endif %}
        
        {% if file.ismain == true %}<div id="mainEditor">{% else %}<div id="{{ file.name }}Editor">{% endif %}{{ file.code | strip }}</div>
        {% endfor %}
        
        <h3>Output</h3>
        <div id="feedbackText"></div>

        <canvas id="pscanvas" height="20px"></canvas>

        <!-- Python script runner -->
        <script type="text/python">
            from browser import document as doc, window
            import tb as traceback
            import sys

            def get_formatted(*args, **kwargs):
                """
                My imitation of Python 3's print() function, so I can
                return the result as a string
                """
                sep = ' '
                end = '\n'
                if 'sep' in kwargs:
                    sep = kwargs['sep']
                if 'end' in kwargs:
                    end = kwargs['end']
                ret = ''
                for i, arg in enumerate(args):
                    ret += "%s"%arg
                    if i < len(args) - 1:
                        ret += sep
                return ret + end

            def run_python_code(code):
                result = ""
                try:
                    window['python_code_result'] = ''
                    code = code.replace("print(", "window['python_code_result'] += get_formatted(")
                    exec(code)
                    result = window['python_code_result']
                except Exception as exc:
                    # Formatting exception
                    result = traceback.format_exc()
                return result
            
            window.run_python_code = run_python_code
        </script>

        <script>
        let canvas = document.getElementById("pscanvas");
        let correctArea = document.getElementById("correctArea");
        let correctlyAnswered = false;
        let numAttempts = 0;

        var editors = new Array();

        {% for file in page.files %}
        {% if file.ismain == true %}
        let mainEditor = ace.edit("mainEditor");
        mainEditor.setFontSize(16);
        mainEditor.session.setMode("ace/mode/python");
        {% if file.isreadonly == true %}
        mainEditor.setReadOnly(true);            
        {% else %}
        mainEditor.setReadOnly(false);            
        {% endif %}
        {% else %}
        let {{ file.name }}Editor = ace.edit("{{ file.name }}Editor");
        {{ file.name }}Editor.setFontSize(16);
        {{ file.name }}Editor.session.setMode("ace/mode/python");
        {% if file.isreadonly == true %}
        {{ file.name }}Editor.setReadOnly(true);            
        {% else %}
        {{ file.name }}Editor.setReadOnly(false);            
        {% endif %} 
        editors.push({{ file.name }}Editor);
        {% endif %}
        {% endfor %}

        let feedback = ace.edit("feedbackText");
        feedback.setFontSize(16);
        feedback.renderer.setShowGutter(false);

        <!-- https://stackoverflow.com/questions/7542586/new-formdata-application-x-www-form-urlencoded -->
        function urlencodeFormData(fd){
            var s = '';
            function encode(s){ return encodeURIComponent(s); }
            for(var pair of fd.entries()){
                if(typeof pair[1]=='string'){
                    s += (s?'&':'') + encode(pair[0])+'='+encode(pair[1]);
                }
            }
            return s;
        }

        /**
         * Send code to the server with a POST command
         * @param {boolean} vpnwarn Whether to warn about connecting to a vpn
         * @param {boolean} halfcredit Whether this is a half credit submission
         */
         function postCode(vpnwarn, halfcredit) {
            <!-- Setting a layout.formprocessor will send a POST request to a form processor -->
            {% if layout.formprocessor and layout.formprocessor != false %}
            submitCode = '';
            
            for (var i in editors) {
                submitCode += editors[i].getValue();
                submitCode += "\n\n";
            }
            
            let url = "{{layout.formprocessor}}";
            url = url.replace("magic", encodeURIComponent("ursinus"));
            url = url.replace("title", encodeURIComponent("{{ page.title | strip }}"));
            url = url.replace("studentnetid", encodeURIComponent(document.getElementById("studentnetid").value));
            url = url.replace("code", encodeURIComponent(submitCode));
            {% if page.canvasasmtid %}
            url = url.replace("canvasasmtid", encodeURIComponent("{{page.canvasasmtid}}"))
            {% endif %}
            {% if page.canvaspoints %}
            url = url.replace("canvaspoints", "{{page.canvaspoints}}");
            {% endif %}
            if (halfcredit) {
                url = url.replace("canvashalfcredit", encodeURIComponent(true));
            }
            window.open(url);

            /*var xhttp = new XMLHttpRequest();
            xhttp.onerror = function(e){
                if (vpnwarn) {
                    alert("Unable to submit.  Please try to submit again!");
                }
            };

            xhttp.open("GET", "{{ layout.formprocessor | strip }}", true)
            

            xhttp.send();*/             
            {% endif %}
        }

        function runCode() {
            try {
                numAttempts++;
                let student_code = "";
                for (var i in editors) {
                    student_code += editors[i].getValue();
                    student_code += "\n";
                }
                student_code += mainEditor.getValue();
                feedbackString = run_python_code(student_code);
                feedback.setValue(feedbackString);
                
                {{ page.processor.feedbackprocess | strip }}
                if ({{ page.processor.correctcheck | strip}}) {
                    correctlyAnswered = true;
                    correctArea.innerHTML = "<h3><font color = #00AA00>{{ page.processor.correctfeedback | strip}}</font></h3>";
                    <!-- Setting a page.processor.submitformlink in the markdown will pop up an iframe with a page of your choice -->
                    {% if page.processor.submitformlink and page.processor.submitformlink != false %}
                    correctArea.innerHTML += `
                    <iframe src = "{{ page.processor.submitformlink | strip }}" width=800 height=500>
                    `;
                    {% endif %}
                    
                    postCode(true, false);
                }
                {% if page.processor.incorrectchecks %}
                {% for check in page.processor.incorrectchecks %}
                else if ({{ check.incorrectcheck | strip}}) {
                    correctArea.innerHTML = "<h3><font color = red>{{ check.feedback | strip }}</font></h3>";
                }
                {% endfor %}
                {% endif %}
                else {
                    correctArea.innerHTML = "<h3><font color = red>{{ page.processor.incorrectfeedback | strip }}</font></h3>";
                }
            }
            catch(err) {
                correctArea.innerHTML = "<h3><font color = red>{{ page.processor.incorrectfeedback | strip }}</font></h3>";
                feedback.setValue("Error: " + err.message);
            }

            {% if page.canvashalftries %}
            if (!correctlyAnswered && numAttempts == {{ page.canvashalftries }}) {
                postCode(false, true);
            }


            {% endif %}

        }
        </script>        
        
    {{ content }} 
  </div>
</div>


{% if page.info.comments %}
<HR>
<div id="disqus_thread"></div>
<script>
    /**
    *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
    *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables    */
    
    var disqus_config = function () {
    this.page.url = "https://ursinus-cs271-f2022.github.io/Modules/{{ page.url }}";  // Replace PAGE_URL with your page's canonical URL variable
    this.page.identifier = "{{ page.url }}"; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
    };
    
    (function() { // DON'T EDIT BELOW THIS LINE
    var d = document, s = d.createElement('script');
    s.src = 'https://ursinuscs371s2021.disqus.com/embed.js';
    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
    })();
</script>
{% endif %}